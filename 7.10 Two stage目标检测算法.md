# Two stage目标检测算法
## 1 算法特点
+ 主干网络为CNN，提取卷积特征；
+ 最早由rgb大神提出，典型代表为R-CNN；
+ 是一种端到端的目标检测算法（基于RPN网络）；
+ 准确度高，速度相对one-stage慢。

## 2 检测流程

<div align=center>
    ![image](https://raw.githubusercontent.com/zhiyuanz-hub/public-picture/master/11-1.jpg)
</div> 

简单来说，就是首先产生候选区域，然后提取CNN特征，最后再进行区域分类和位置精修。

## 3 常见算法
代表算法有：R-CNN，Fast R-CNN，Faster R-CNN，以及各种变体，如下图所示：

<div align=center>
    ![image](https://raw.githubusercontent.com/zhiyuanz-hub/public-picture/master/11-2.jpg)
</div> 

## 4 核心组件
核心组件就是主干网络CNN，加RPN网络，关于CNN网络要遵循以下几个原则：
+ 尽量去繁从简；
+ 多尺度特征融合；
+ 模型尽量轻量化；

RPN网络：

1. 区域推荐

采用anchor机制:

<div align=center>
    ![image](https://raw.githubusercontent.com/zhiyuanz-hub/public-picture/master/11-3.jpg)
</div> 

以每个feature map的每一个像素为中心（叫做锚点），按照不同比例提取候选区域，以Fast R-CNN为例，会采用9个不同的尺度，所以最后会提取到wxhx9个候选区域；然后利用GT来对这些候选区域进行筛选，得到正样本和负样本，这里要注意GT和候选区域的size。

2. ROI Pooling

ROI Pooling属于RPN网络的一个layer，它的输入有3部分，分别为：feature map、ROIs（例如1x5x1x1，这里的5指的是x，y，w，h，idx，idx索引是为了将x，y，w，h指定的ROI信息映射到feature map，因为可能会有多个ROI映射到同一个feature map）、ROI参数（缩放尺度参数等）；输
出则是固定尺寸的feature map；总结的说，ROI Pooling的作用其实就是完成了抠图加resize的
操作。

## 5 two-stage的改进方向
+ 寻求更好的网络特征；
+ 寻求更好的RPN网络；
+ 更完善的ROI分类；
+ 样本后处理；
+ 更大的mini-batch。

## 6 two-stage的优缺点：
优点：准确度高、anchor机制、共享计算量；

缺点：速度慢、训练时间长。
